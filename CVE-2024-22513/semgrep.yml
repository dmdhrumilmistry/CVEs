rules:
  - id: CVE-2024-22513
    patterns:
      - pattern: $TOKEN.for_user($USER)
      - pattern-not-inside: |
          if $USER and $USER.is_active: 
            $TOKEN.for_user($USER)
      - pattern-not-inside: |
          if $USER.is_active: 
            $TOKEN.for_user($USER)
      - metavariable-pattern:
          metavariable: $TOKEN
          pattern-either:
            - pattern: Token
            - pattern: AccessToken
            - pattern: RefreshToken
            - pattern: SlidingToken
            - pattern: UntypedToken
    message: Verify that user is active or not before generating JWT tokens for the user. 
    languages:
      - python
    severity: WARNING
    metadata:
      category: security
      technology:
        - django
        - jwt
        - drf
        - django-rest-framework
        - python
      impact: HIGH
      likelihood: HIGH
      confidence: HIGH
      subcategory:
        - audit
